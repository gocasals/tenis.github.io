<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ladies and gentlemen, quiet please.</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 20px; left: 200px }
    h1 { margin-bottom: 12px; }
    #court {
      position: relative;
      width: 600px;
      height: 400px;
      background-image: url('tenis.jpg'); /* tu imagen */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: 2px solid #333;
    }
     #court.alt {
      background-image: url('tenis-crowd.jpg'); /* tu imagen */
    }
    
    /* Overlay en forma de franja naranja */
    #crowdOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border-radius: 50%; /* simula el óvalo */
      pointer-events: none;
      display: none; /* oculto por defecto */
      
      /* Gradiente radial: transparente en el centro, naranja en la franja */
      background: radial-gradient(
        circle,
        rgba(255,140,0,0) 50%,       /* centro transparente */
        rgba(255,140,0,0.4) 70%,     /* franja naranja */
        rgba(255,140,0,0.4) 100%     /* borde naranja */
      );
    }

  </style>
</head>
<body>
  <h1>Ladies and gentlemen, quiet please.</h1>
  <div class="controls">
    <label>Tipo:</label>
      <label><input type="checkbox" value="grunt" checked> Grunt</label>
      <label><input type="checkbox" value="shot" checked> Shot</label>
      <label><input type="checkbox" value="crowd"> Crowd</label>
    <br/>
    <label>Jugador:
      <select id="jugador">
        <option value="">Todos</option>
        <option value="sinner">Sinner</option>
        <option value="alcaraz">Alcaraz</option>
      </select>
    </label>
    <label>Dato:
      <select id="dato">
        <option value="promedio">Volumen promedio</option>
        <option value="pico">Pico de volumen</option>
      </select>
    </label>
    <button onclick="renderHeatmap()">Actualizar</button>
  </div>

  <div id="court">
      <!-- capa naranja para crowd -->
    <div id="crowdOverlay"></div>
  </div>
    <div style="margin-top:20px;">
  
  <div style="display:flex; align-items:center;">
    <!-- Bloque de color -->
    <div style="width:40px; height:20px; background-color:blue;"></div>
    <span style="margin:0 10px;">0 - 20%</span>

    <div style="width:40px; height:20px; background-color:cyan;"></div>
    <span style="margin:0 10px;">20 - 40%</span>

    <div style="width:40px; height:20px; background-color:lime;"></div>
    <span style="margin:0 10px;">40 - 60%</span>

    <div style="width:40px; height:20px; background-color:yellow;"></div>
    <span style="margin:0 10px;">60 - 80%</span>

    <div style="width:40px; height:20px; background-color:red;"></div>
    <span style="margin:0 10px;">80 - 100%</span> 
  </div>
  <span style="margin:0 10px;">(*)El número representa la duración promedio del tipo de golpe en esa área.</span>
</div>

  <!-- Librería heatmap.js -->
  <script src="https://cdn.jsdelivr.net/npm/heatmapjs@2.0.2/heatmap.min.js"></script>
  <script>
    // Coordenadas aproximadas para cada celda (ajustadas a 400x600)
    colm1=130;
    colm2=colm1+70;
    colm3=colm2+70;
    colm4=colm3+70;
    colm5=colm4+70;
    colm6=colm5+70;

    fila1=140;
    fila2=fila1+40;
    fila3=fila2+40;
    fila4=fila3+40;
    

    const POSITIONS = {
      "B1": [colm1, fila1],  "B2": [colm1, fila2],  "B3": [colm1, fila3],  "B4": [colm1, fila4],
      "B5": [colm2, fila1], "B6": [colm2, fila2],  "B7": [colm2, fila2],  "B8": [colm2, fila4],
      "B9": [colm3, fila1], "B10": [colm3, fila2], "B11": [colm3, fila3], "B12": [colm3, fila4],

      "A1": [colm4, fila1],  "A2": [colm4, fila2],  "A3": [colm4, fila3],  "A4": [colm4, fila4],
      "A5": [colm5, fila1], "A6": [colm5, fila2],  "A7": [colm5, fila3],  "A8": [colm5, fila4],
      "A9": [colm6, fila1], "A10": [colm6, fila2], "A11": [colm6, fila3], "A12": [colm6, fila4],
    };

    const RAW = [
      { notation: "-", promedio: -29.8, pico: -11.9, duracion: 31, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b2", promedio: -39.1, pico: -9.5, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "punto 1 on" },
{ notation: "-", promedio: -28.9, pico: -12.4, duracion: 0.6, tipo: "crowd", jugador: "-" , notaciones: "out" },
{ notation: "b2", promedio: -42.2, pico: -12.8, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -41.7, pico: -18.3, duracion: 0.7, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -38.5, pico: -8, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -32.4, pico: -16.8, duracion: 1, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -39.6, pico: -9.7, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -44.5, pico: -24.8, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -36.9, pico: -19.6, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -37.3, pico: -7.2, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -32.8, pico: -18.2, duracion: 0.7, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -39.1, pico: -8, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -42.4, pico: -22.3, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -35.3, pico: -17.2, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -37.9, pico: -7.3, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -31.5, pico: -17.9, duracion: 0.8, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -36.7, pico: -6.4, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "punto 1 off" },
{ notation: "-", promedio: -30.2, pico: -8.4, duracion: 35, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "a10", promedio: -35.4, pico: -18.1, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 2 on" },
{ notation: "a10", promedio: -39.7, pico: -8.2, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a6", promedio: -38.9, pico: -18.2, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b4", promedio: -38.7, pico: -8.8, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b4", promedio: -40.6, pico: -23.3, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -41.5, pico: -16.3, duracion: 0.1, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.0, pico: -8.5, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -38.5, pico: -17.2, duracion: 0.9, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -37.2, pico: -7, duracion: 0.2, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b1", promedio: -38.4, pico: -6.4, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b1", promedio: -37.5, pico: -23.4, duracion: 0.6, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -38.2, pico: -10.7, duracion: 0.2, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -38.8, pico: -8.8, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -37.5, pico: -13.7, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 2 off" },
{ notation: "-", promedio: -27.8, pico: -9.8, duracion: 34, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "a11", promedio: -38.3, pico: -20, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 3 on" },
{ notation: "a11", promedio: -39.6, pico: -10.4, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a7", promedio: -35.3, pico: -15.5, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b1", promedio: -38.4, pico: -7.6, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b1", promedio: -48.1, pico: -25.5, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -40.5, pico: -14.2, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -41.7, pico: -11.7, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -38.5, pico: -18.2, duracion: 1, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -40.0, pico: -10.8, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -45.9, pico: -26.2, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -34.8, pico: -17.4, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -37.2, pico: -9.9, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -38.9, pico: -22, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -38.7, pico: -8.4, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -46.7, pico: -22.3, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -46.1, pico: -21.7, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.3, pico: -6.9, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "punto 3 off" },
{ notation: "-", promedio: -26.9, pico: -12.1, duracion: 0.3, tipo: "crowd", jugador: "-" , notaciones: "out" },
{ notation: "-", promedio: -31.0, pico: -10.7, duracion: 37, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b3", promedio: -51.2, pico: -28.2, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "punto 4 on" },
{ notation: "b3", promedio: -38.6, pico: -7.3, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b7", promedio: -43.9, pico: -18.8, duracion: 0.5, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -36.7, pico: -6.6, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -35.8, pico: -17.2, duracion: 0.7, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -39.9, pico: -7.3, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -41.0, pico: -21.8, duracion: 1, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -47.5, pico: -21.2, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -41.2, pico: -6.1, duracion: 0.2, tipo: "grunt", jugador: "sinner" , notaciones: "punto 4 off" },
{ notation: "-", promedio: -26.9, pico: -8.7, duracion: 41, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b2", promedio: -53.6, pico: -31.3, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "punto 5 on" },
{ notation: "b2", promedio: -39.5, pico: -6.6, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "-", promedio: -49.0, pico: -23.2, duracion: 6.7, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b2", promedio: -44.7, pico: -14.2, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b6", promedio: -43.0, pico: -21.8, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -44.7, pico: -18.2, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -38.2, pico: -8.3, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -35.2, pico: -19.7, duracion: 0.9, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -40.9, pico: -10.5, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -48.2, pico: -28.4, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -50.9, pico: -26.1, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -38.1, pico: -11.3, duracion: 0.3, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.5, pico: -21.8, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -45.2, pico: -23.8, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -37.4, pico: -6.9, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -46.5, pico: -23.6, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -48.8, pico: -23.3, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -39.9, pico: -12.3, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -38.7, pico: -23.2, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -39.6, pico: -9.5, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -44.9, pico: -23.1, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -50.7, pico: -26.7, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.4, pico: -11.3, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.2, pico: -24.5, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -36.4, pico: -6.4, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "punto 5 off" },
{ notation: "-", promedio: -29.1, pico: -9.9, duracion: 41, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "a10", promedio: -39.8, pico: -21.6, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 6 on" },
{ notation: "a6", promedio: -40.7, pico: -9, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a6", promedio: -43.8, pico: -22.2, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -38.2, pico: -7.8, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -49.9, pico: -32.4, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -46.3, pico: -22.6, duracion: 0.2, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -43.6, pico: -13.6, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -40.0, pico: -21.6, duracion: 0.7, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -51.4, pico: -24.1, duracion: 0.1, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -39.9, pico: -11.2, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -46.2, pico: -26.2, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -48.2, pico: -23.7, duracion: 0.2, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -39.8, pico: -12, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -41.5, pico: -26.1, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -42.1, pico: -18.2, duracion: 0.1, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -38.2, pico: -7.2, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "punto 6 off" },
{ notation: "-", promedio: -31.1, pico: -10.1, duracion: 52, tipo: "crowd", jugador: "-" , notaciones: "cambio de lado" },
{ notation: "a11", promedio: -44.3, pico: -25.9, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 7 on" },
{ notation: "a11", promedio: -42.3, pico: -12.7, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -45.7, pico: -27.5, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b1", promedio: -41.4, pico: -14.6, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -44.8, pico: -15.5, duracion: 0.3, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -48.2, pico: -28.8, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -47.2, pico: -22.2, duracion: 1, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -42.7, pico: -14.9, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -51.5, pico: -28.5, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -46.5, pico: -23, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -40.9, pico: -12.4, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -46.2, pico: -28.1, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -52.8, pico: -27.2, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b4", promedio: -41.8, pico: -14, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -58.1, pico: -32.1, duracion: 0.2, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -41.9, pico: -14.4, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -46.6, pico: -28.1, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 7 off" },
{ notation: "-", promedio: -29.9, pico: -10.1, duracion: 36, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b3", promedio: -39.1, pico: -10.8, duracion: 0.3, tipo: "shot", jugador: "sinner" , notaciones: "punto 8 on" },
{ notation: "a10", promedio: -38.5, pico: -9.3, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -32.3, pico: -14.3, duracion: 0.7, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 8 off" },
{ notation: "-", promedio: -31.2, pico: -6.8, duracion: 24, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b2", promedio: -53.3, pico: -25.8, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "punto 9 on" },
{ notation: "b6", promedio: -39.6, pico: -10.7, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b6", promedio: -43.5, pico: -19, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -38.2, pico: -6.7, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -38.5, pico: -21.2, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -52.0, pico: -31.8, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b3", promedio: -40.0, pico: -9.7, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -46.2, pico: -25.6, duracion: 0.7, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a9", promedio: -40.3, pico: -12.9, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a9", promedio: -42.1, pico: -26.8, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -39.7, pico: -14.8, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b7", promedio: -49.6, pico: -27.9, duracion: 0.4, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -43.1, pico: -25.3, duracion: 0.5, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -38.1, pico: -6.6, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a11", promedio: -37.3, pico: -19.2, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -44.2, pico: -22.5, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -41.2, pico: -13, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "punto 9 off" },
{ notation: "-", promedio: -28.2, pico: -7.9, duracion: 36, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "a10", promedio: -39.7, pico: -20.7, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 10 on" },
{ notation: "a10", promedio: -39.3, pico: -9.3, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a6", promedio: -43.1, pico: -23, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "-", promedio: -34.6, pico: -10.4, duracion: 1, tipo: "crowd", jugador: "-" , notaciones: "out" },
{ notation: "a10", promedio: -42.8, pico: -22.2, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -42.7, pico: -12.6, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a6", promedio: -45.0, pico: -24.2, duracion: 0.6, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b7", promedio: -41.5, pico: -13.6, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b7", promedio: -47.5, pico: -24.1, duracion: 0.5, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "a10", promedio: -41.1, pico: -13.3, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -47.0, pico: -29, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b3", promedio: -48.9, pico: -27.7, duracion: 0.6, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b7", promedio: -40.8, pico: -13.4, duracion: 0.1, tipo: "shot", jugador: "sinner" , notaciones: "punto 10 off" },
{ notation: "-", promedio: -31.8, pico: -11.2, duracion: 31, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "a11", promedio: -44.5, pico: -25.1, duracion: 0.2, tipo: "grunt", jugador: "alcaraz" , notaciones: "punto 11 on" },
{ notation: "a11", promedio: -40.0, pico: -8.4, duracion: 0.2, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "b2", promedio: -47.4, pico: -24.7, duracion: 0.3, tipo: "grunt", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -41.5, pico: -11.1, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "b2", promedio: -38.5, pico: -10.1, duracion: 0.5, tipo: "grunt", jugador: "sinner" , notaciones: "punto 11 off" },
{ notation: "-", promedio: -30.4, pico: -9.9, duracion: 36, tipo: "crowd", jugador: "-" , notaciones: "" },
{ notation: "b3", promedio: -43.5, pico: -15.6, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "punto 12 on" },
{ notation: "a10", promedio: -53.0, pico: -27.6, duracion: 0.3, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -46.2, pico: -18.9, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "" },
{ notation: "a10", promedio: -54.1, pico: -33.2, duracion: 0.4, tipo: "grunt", jugador: "alcaraz" , notaciones: "" },
{ notation: "b11", promedio: -45.5, pico: -16.6, duracion: 0.2, tipo: "shot", jugador: "sinner" , notaciones: "" },
{ notation: "a11", promedio: -41.0, pico: -13.7, duracion: 0.1, tipo: "shot", jugador: "alcaraz" , notaciones: "punto 12 off" },
{ notation: "-", promedio: -25.0, pico: -9.1, duracion: 12, tipo: "crowd", jugador: "-" , notaciones: "último sonido" },
    ];
    // Datos simplificados desde tu Excel (ejemplo)
  
    // Convertir a puntos heatmap.js
    const points = RAW.map(d => {
      const key = d.notation.toUpperCase();
      const pos = POSITIONS[key];
      if(!pos) return null;
      //const val = 60 - d.avgDb; // invierte escala
      //return { x: pos[0], y: pos[1], value: val };
      return { x: pos[0], y: pos[1], value: d.promedio };
    }).filter(Boolean);

    // Calcular min/max
    const values = points.map(p => p.value);
    const min = Math.min(...values);
    const max = Math.max(...values);

    // Inicializar heatmap
    const heatmapInstance = h337.create({
      container: document.getElementById('court'),
      radius: 40,
      maxOpacity: 0.6,
      blur: 0.9,
      backgroundColor: 'rgba(0,0,0,0)',
      gradient: {
        '.2': 'blue',
        '.4': 'cyan',
        '.6': 'lime',
        '.8': 'yellow',
        '1.0': 'red'
      }
    });

   
    // Ejemplo: poner una etiqueta en la posición (100, 150)
    function agregarEtiqueta(x, y, texto) {
      const label = document.createElement('div');
      label.className = 'label-point';
      label.style.position = 'absolute';
      label.style.left = (x) + 'px';
      label.style.top = (y) + 'px';
      label.style.color = '#000';
      label.style.background = 'rgba(255,255,255,0.7)';
      label.style.padding = '2px 4px';
      label.style.borderRadius = '4px';
      label.style.fontSize = '10px';
      label.style.pointerEvents = 'none';
      label.textContent = texto;

      document.getElementById('court').appendChild(label);
    }

    const filtrados = RAW.filter(d => d.notation === "-");


function renderHeatmap(){
      // Obtener seleccionados
      const selected = Array.from(document.querySelectorAll('input[type=checkbox]:checked'))
                            .map(cb => cb.value);
      // Filtrar dataset
      const filteredData = RAW.filter(d => selected.includes(d.tipo));
      const jugador = document.getElementById('jugador').value;
      const dato = document.getElementById('dato').value;

      // Eliminar etiquetas anteriores
      document.querySelectorAll('.label-point').forEach(el => el.remove());

      // Filtrar datos
      let filtered = filteredData.filter(d => (jugador==="" || d.jugador===jugador));

      // Mostrar overlay naranja si es Crowd
      if(selected.includes("crowd"))
      {
        document.getElementById('court').classList.add('alt');
        if(dato==="promedio"){
          var promedio = filtrados.reduce((a, b) => a + b.promedio, 0) / filtrados.length;
          agregarEtiqueta(280, 50, promedio.toFixed(1)+"db");
        }else if(dato==="pico"){
          var promedio = filtrados.reduce((a, b) => a + b.pico, 0) / filtrados.length;
          agregarEtiqueta(280, 50, promedio.toFixed(1)+"db");
        }
      } else {
        document.getElementById('court').classList.remove('alt');
      }

      // Convertir a puntos
      const points = filtered.map(d => {
        const key = d.notation.toUpperCase();
        const pos = POSITIONS[key];
        const duracion = d.duracion;
        if(!pos) return null;
        let value;
         if(dato==="promedio") value = 60 - Math.abs(d.promedio); // normalizar dB
        else if(dato==="pico") value = 40 - Math.abs(d.pico);
        return { x: pos[0], y: pos[1], value: value, duracion: duracion };
      }).filter(Boolean);

     

      // Calcular min/max
      const values = points.map(p => p.value);
      const min = values.length ? Math.min(...values) : 0;
      const max = values.length ? Math.max(...values) : 1;
      
      // Actualizar heatmap
      heatmapInstance.setData({ min, max, data: points });



      // Agregar etiquetas nuevas
      //const court = document.getElementById('court');

      // Agrupar puntos por coordenadas
      const grouped = {};

      points.forEach(p => {
        const key = `${p.x},${p.y}`;
        if (!grouped[key]) {
          grouped[key] = { x: p.x, y: p.y, duraciones: [] };
        }
        grouped[key].duraciones.push(p.duracion);
      });

      // Calcular promedio y crear etiquetas
      Object.values(grouped).forEach(g => {
        const avg = g.duraciones.reduce((a, b) => a + b, 0) / g.duraciones.length;
        var text = avg.toFixed(1) + " seg (*)";
        agregarEtiqueta(g.x - 15, g.y - 20, text);
      });

    }

    // Render inicial
    renderHeatmap();

  </script>
</body>
</html>




